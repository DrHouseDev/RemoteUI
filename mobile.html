<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>Steam Remote Mobile Client</title>
	<style>
		html, body {
			width: 100%;
			height: 100%;
		}
		
		body {
			margin: 0;
			background: #2c3e50 url('icons/steam_home_os.png') center no-repeat fixed;
			transform: translate(0px, 0);
			transition: background-image .1s linear;
		}
		
		.tap {
			background-image: url('icons/Single_Tap.png');
		}
		
		.doubletap {
			background-image: url('icons/Double_Tap.png');
		}
		
		.pinch {
			background-image: url('icons/Pinch.png');
		}
		
		.swipeleft {
			background-image: url('icons/Swipe_Left.png');
		}
		
		.swiperight {
			background-image: url('icons/Swipe_Right.png');
		}
		
		.swipeup {
			background-image: url('icons/Swipe_Up.png');
		}
		
		.swipedown {
			background-image: url('icons/Swipe_Down.png');
		}
		
		.drag {
			background-image: url('icons/Hold_Timer.png');
		}
	</style>
</head>
<body>
	<script src="libs/jquery-1.9.1.min.js"></script>
	<script src="js/hammer.js"></script>
	<script src="js/hammer_fakemultitouch.js"></script>
	<script src="js/RemoteClient.js"></script>
	<script>
		(function()
		{
			// Send a request straight away so it asks for permission if needed
			SteamRemoteClient.DoGET( 'authorized/' );
			
			Hammer.plugins.fakeMultitouch();
			
			var hammer = Hammer( document.body,
			                     {
			                        drag_block_horizontal: true,
			                        drag_block_vertical: true,
			                        tap_always: false
			                     }),
			    iconTimeout = 0,
			    previousIcon = false;
			
			var lastX = 0.0, lastY = 0.0;
			
			hammer.on( 'tap', function( )
			{
				ShowIcon( 'tap' );
				
				SteamRemoteClient.DoPOST( 'mouse/click', { button: 'mouse_left' } );
			} );
			
			hammer.on( 'doubletap', function( )
			{
				ShowIcon( 'doubletap' );
				
				SteamRemoteClient.Button.Press( 'enter' );
			} );
			
			hammer.on( 'pinch', function( )
			{
				ShowIcon( 'Pinch' );
				
				SteamRemoteClient.Button.Press( 'escape' );
			} );
			
			hammer.on( 'swipeleft', function( )
			{
				ShowIcon( 'swipeleft' );
				
				SteamRemoteClient.Button.Press( 'left' );
			} );
			
			hammer.on( 'swipeup', function( )
			{
				ShowIcon( 'swipeup' );
				
				SteamRemoteClient.Button.Press( 'up' );
			} );
			
			hammer.on( 'swipedown', function( )
			{
				ShowIcon( 'swipedown' );
				
				SteamRemoteClient.Button.Press( 'down' );
			} );
			
			hammer.on( 'swiperight', function( )
			{
				ShowIcon( 'swiperight' );
				
				SteamRemoteClient.Button.Press( 'right' );
			} );
			
			hammer.on( 'drag', function( e )
			{
				//ShowIcon( 'drag' );
				
				var x = e.gesture.deltaX - lastX,
				    y = e.gesture.deltaY - lastY;
				
				lastX = e.gesture.deltaX;
				lastY = e.gesture.deltaY;
				
				SteamRemoteClient.DoPOST( 'mouse/move',
					{
						delta_x: x,
						delta_y: y
					}
				);
			} );
			
			hammer.on( 'release', function( )
			{
				lastX = lastY = 0.0;
			} );
			
			function ShowIcon( elementName )
			{
				$( 'body' ).addClass( elementName );
				
				if( previousIcon !== false && previousIcon !== elementName )
				{
					RemoveIcon( );
				}
				
				previousIcon = elementName;
				
				clearTimeout( iconTimeout );
				iconTimeout = setTimeout( RemoveIcon, 2500 );
			}
			
			function RemoveIcon( )
			{
				$( 'body' ).removeClass( previousIcon );
			}
		}());
	</script>
</body>
</html>